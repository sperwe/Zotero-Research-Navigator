# Note Relations Tab 设计结构图

## 整体布局

```
┌─────────────────────────────────────────────────────────────┐
│                     Note Relations Tab                       │
├─────────────────────┬───────────────────────────────────────┤
│                     │                                         │
│  左侧：节点选择器     │         右侧：笔记内容区                │
│  (nodeSelector)     │      (contentContainer)               │
│                     │                                         │
│  宽度：250px        │         flex: 1                        │
│                     │                                         │
└─────────────────────┴───────────────────────────────────────┘
```

## 左侧：节点选择器 (nodeSelector)

```
┌─────────────────────────────┐
│  Select History Node        │ ← 标题 (header)
├─────────────────────────────┤
│  [🔍 Search nodes...]       │ ← 搜索框 (searchBox)
├─────────────────────────────┤
│  节点列表 (nodeList)         │
│  ┌─────────────────────┐   │
│  │ 2025/8/29           │   │ ← 会话标题 (sessionTitle)
│  ├─────────────────────┤   │
│  │ 📖 节点1     [2]    │   │ ← 节点元素 (nodeElement)
│  │ 📕 节点2     [0]    │   │   - 图标 (icon)
│  │ 📖 节点3     [1]    │   │   - 标题 (title)
│  └─────────────────────┘   │   - 笔记数量徽章 (badge)
│                             │
└─────────────────────────────┘
```

### 节点元素代码位置
- `createNodeElement()` - 第160-246行
  - 图标：第171-175行
  - 标题：第177-187行
  - 徽章：第189-209行
  - 点击事件：第211-229行

## 右侧：笔记内容区 (contentContainer)

### 空状态
```
┌─────────────────────────────────────────┐
│                                         │
│                                         │
│      Select a node to view its         │
│      associated notes                   │
│                                         │
│                                         │
└─────────────────────────────────────────┘
```

### 选中节点后
```
┌─────────────────────────────────────────┐
│  标题栏 (header)                         │
│  ┌─────────────────────────────────┐   │
│  │ 节点标题                        │   │
│  │ 2025/8/29 19:15:44 - active   │   │
│  └─────────────────────────────────┘   │
├─────────────────────────────────────────┤
│  工具栏 (toolbar)                        │
│  [Add Note] [Create New Note] [🔍___]   │
├─────────────────────────────────────────┤
│  内容区 (content)                        │
│                                         │
│  Associated Notes (1)                   │ ← 关联笔记部分
│  ┌─────────────────────────────────┐   │
│  │ 笔记卡片 (noteCard)              │   │
│  │ ┌───────────────────────────┐   │   │
│  │ │ 笔记标题    [Remove][Open] │   │   │
│  │ │ Type: created_during      │   │   │
│  │ ├───────────────────────────┤   │   │
│  │ │ 笔记内容预览...           │   │   │
│  │ ├───────────────────────────┤   │   │
│  │ │ Modified: 2025/8/29       │   │   │
│  │ └───────────────────────────┘   │   │
│  └─────────────────────────────────┘   │
│                                         │
│  Suggested Notes (0)                    │ ← 建议笔记部分
│                                         │
└─────────────────────────────────────────┘
```

## 关键方法对应关系

| 设计元素 | 对应方法 | 代码位置 |
|---------|---------|---------|
| 主容器 | `create()` | 31-60行 |
| 左侧节点选择器 | `createNodeSelector()` | 65-115行 |
| 节点列表 | `loadRecentNodes()` | 120-152行 |
| 节点元素 | `createNodeElement()` | 160-246行 |
| 右侧内容区 | `loadNodeAssociations()` | 261-334行 |
| 工具栏 | `createToolbar()` | 339-378行 |
| 关联笔记部分 | `createAssociatedSection()` | 383-413行 |
| 建议笔记部分 | `createSuggestedSection()` | 418-443行 |
| 笔记卡片 | `createNoteCard()` | 448-591行 |
| 空状态 | `showEmptyState()` | 754-774行 |

## 交互流程

1. 用户点击左侧节点 → `nodeElement.addEventListener("click")` (211行)
2. 触发 `selectNode()` → 更新 `this.selectedNode` (252行)
3. 调用 `loadNodeAssociations()` → 加载笔记数据 (261行)
4. 显示笔记卡片 → `createNoteCard()` 创建每个笔记的UI (448行)
5. 用户点击 "Open" → 打开笔记编辑器 (530行)
6. 用户点击 "Remove" → 移除关联 (500行)

## 样式变量
- 背景色：`var(--material-sidepane)`, `var(--material-background)`
- 边框色：`var(--material-border-quarternary)`
- 文字色：`var(--fill-secondary)`, `var(--fill-tertiary)`
- 选中色：`var(--material-mix-quinary)`