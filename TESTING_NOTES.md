# Zotero Research Navigator 测试注意事项

## 当前状态

插件已成功加载并运行，但观察到以下行为：

### 1. WebSocket 错误
```
WebSocket connection closed: 1006 3
```

这个错误可能是 Zotero 自身的问题，而不是插件导致的。已采取的措施：
- 添加了窗口加载状态检查
- 增加了初始化延迟
- 改进了错误处理

### 2. 已完成的改进

#### 主窗口加载优化
- 等待窗口完全加载后再初始化 UI
- 添加了窗口类型检查，只在主 Zotero 窗口初始化 UI
- 增加了 100ms 延迟确保 Zotero UI 完全准备好

#### UI 初始化改进
- 将 UI 组件初始化分步进行
- 单个组件失败不会阻止其他组件初始化
- 添加了详细的日志记录

#### 工具栏位置更新
- 添加了更多 Zotero 7 的工具栏位置
- 改进了按钮创建逻辑

## 测试步骤

1. **安装插件**
   - 下载 `releases/zotero-research-navigator-v2.0.3-refactored.xpi`
   - 在 Zotero 中：工具 → 附加组件 → 从文件安装附加组件

2. **验证功能**
   - 检查工具栏按钮是否显示
   - 使用 Ctrl/Cmd+Shift+H 快捷键
   - 查看历史面板功能
   - 测试右键菜单

3. **查看日志**
   - 工具 → 开发者 → 错误控制台
   - 查找 `[Research Navigator]` 开头的日志

## 已知问题

1. **WebSocket 错误**
   - 不影响插件功能
   - 可能是 Zotero 内部组件的问题

2. **TypeScript 警告**
   - 编译时有类型警告，但不影响运行
   - 建议后续版本中逐步解决

## 调试建议

如果遇到问题：

1. **清除缓存启动**
   ```
   zotero -purgecaches
   ```

2. **查看详细日志**
   - 启用调试日志：`extensions.zotero.debug.log = true`
   - 查看错误控制台

3. **测试基本功能**
   - 先测试工具栏按钮
   - 再测试快捷键
   - 最后测试完整功能

## 版本信息

- 插件版本：2.0.3
- Zotero 兼容性：7.0 - 7.1.*
- 构建时间：2024-12-27